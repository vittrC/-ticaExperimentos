<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TypeRacer Neon Multiplayer</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      background: black;
      color: #00ff9c;
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    h1, h2, h3 {
      text-shadow: 0 0 10px #00ff9c, 0 0 30px #00ff9c;
      margin-bottom: 20px;
    }
    .container {
      max-width: 800px;
      width: 100%;
      border: 2px solid #00ff9c;
      border-radius: 12px;
      box-shadow: 0 0 20px #00ff9c;
      padding: 30px;
      background-color: rgba(0, 0, 0, 0.8);
      text-align: center;
    }
    .button {
      margin-top: 20px;
      padding: 12px 30px;
      font-size: 1rem;
      background: transparent;
      border: 2px solid #00ff9c;
      color: #00ff9c;
      cursor: pointer;
      border-radius: 6px;
      box-shadow: 0 0 10px #00ff9c;
      transition: 0.3s ease;
    }
    .button:hover {
      background: #00ff9c;
      color: black;
    }
    .hidden { display: none; }
    .text-display {
      font-size: 1.4rem;
      margin-bottom: 20px;
      line-height: 1.8;
      min-height: 100px;
    }
    .input-area {
      width: 100%;
      padding: 15px;
      font-size: 1.2rem;
      border: 2px solid #00ff9c;
      border-radius: 8px;
      background: black;
      color: #00ff9c;
    }
    .stats {
      margin-top: 20px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="container" id="menu">
    <h1>TypeRacer Neon</h1>
    <h3>Multiplayer Online - Sala com at√© 6 jogadores</h3>
    <button class="button" onclick="entrarNaSala()">Iniciar</button>
  </div>

  <div class="container hidden" id="game">
    <h2>Sala: <span id="salaId">...</span></h2>
    <div class="stats">
      Jogador: <span id="nomeJogador">...</span><br>
      Rodada: <span id="rodada">1</span>/10 |
      Pontos: <span id="pontuacao">0</span> |
      Tempo: <span id="tempo">0</span>s
    </div>
    <div class="text-display" id="fraseDisplay"></div>
    <input type="text" class="input-area" id="entrada" placeholder="Digite aqui..." disabled />
    <div class="stats" id="feedback"></div>
  </div>

  <script>
    // CONFIGURE COM SEU PROJETO
  const firebaseConfig = {
       apiKey: "AIzaSyAVZ-dvyJuGFF4fEHGjS-TrhzBmBslVwNs",
       authDomain: "curso-3-inteligencia-emocional.firebaseapp.com",
       projectId: "curso-3-inteligencia-emocional",
       storageBucket: "curso-3-inteligencia-emocional.firebasestorage.app",
       messagingSenderId: "105031303963",
       appId: "1:105031303963:web:0ecdcddc91fbb0af69c9be"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const frases = [
      "A comunica√ß√£o eficaz √© a base de qualquer rela√ß√£o bem-sucedida.",
      "Falar √© uma necessidade, escutar √© uma arte.",
      "Palavras s√£o poderosas, use-as com sabedoria.",
      "A clareza na fala evita ru√≠dos na escuta.",
      "Empatia √© entender antes de responder.",
      "O sil√™ncio tamb√©m comunica.",
      "Boas conversas geram grandes ideias.",
      "Conex√µes verdadeiras nascem de palavras sinceras.",
      "A voz calma acalma at√© o caos.",
      "Ser ouvido √© t√£o importante quanto ser entendido.",
      "Conversar √© mais que falar, √© se conectar.",
      "A escuta ativa transforma discuss√µes em acordos.",
      "O tom muda o significado das palavras.",
      "Palavras ditas n√£o voltam, escolha com aten√ß√£o.",
      "Comunique com inten√ß√£o, n√£o por obriga√ß√£o.",
      "Respostas r√°pidas n√£o s√£o sempre as melhores.",
      "A comunica√ß√£o come√ßa com respeito.",
      "Entender n√£o √© o mesmo que concordar.",
      "A paci√™ncia melhora qualquer conversa.",
      "O di√°logo √© o caminho para solu√ß√µes reais."
    ];

    const jogadorId = "Jogador-" + Math.floor(Math.random() * 10000);
    let salaDoc, salaId;
    let rodadaAtual = 0;
    let pontuacao = 0;
    let fraseAtual = "";
    let tempoInicio, timer;
    const maxRodadas = 10;

    async function entrarNaSala() {
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("nomeJogador").textContent = jogadorId;

      const salas = await db.collection("salas").get();
      let sala = null;

      for (const doc of salas.docs) {
        const data = doc.data();
        if (data.jogadores.length < 6 && !data.finalizado) {
          sala = doc;
          break;
        }
      }

      if (!sala) {
        salaId = "sala-" + Math.floor(Math.random() * 10000);
        await db.collection("salas").doc(salaId).set({
          jogadores: [jogadorId],
          rodada: 0,
          finalizado: false
        });
      } else {
        salaId = sala.id;
        await db.collection("salas").doc(salaId).update({
          jogadores: firebase.firestore.FieldValue.arrayUnion(jogadorId)
        });
      }

      document.getElementById("salaId").textContent = salaId;
      document.getElementById("game").classList.remove("hidden");

      salaDoc = db.collection("salas").doc(salaId);
      salaDoc.onSnapshot(doc => {
        const data = doc.data();
        rodadaAtual = data.rodada;

        if (rodadaAtual >= maxRodadas) {
          encerrarJogo();
        } else if (data.frase && data.frase !== fraseAtual) {
          iniciarRodada(data.frase);
        }
      });

      // Se for o primeiro jogador, inicia a rodada
      const docData = (await salaDoc.get()).data();
      if (docData.jogadores[0] === jogadorId) {
        proximaRodada();
      }
    }

    function proximaRodada() {
      const novaFrase = frases[Math.floor(Math.random() * frases.length)];
      fraseAtual = novaFrase;
      salaDoc.update({
        rodada: rodadaAtual + 1,
        frase: novaFrase
      });
    }

    function iniciarRodada(frase) {
      document.getElementById("entrada").value = "";
      document.getElementById("entrada").disabled = false;
      document.getElementById("entrada").focus();
      document.getElementById("fraseDisplay").textContent = frase;
      document.getElementById("rodada").textContent = rodadaAtual + 1;
      document.getElementById("feedback").textContent = "";
      tempoInicio = Date.now();
      clearInterval(timer);
      timer = setInterval(() => {
        const tempo = Math.floor((Date.now() - tempoInicio) / 1000);
        document.getElementById("tempo").textContent = tempo;
      }, 1000);
    }

    document.getElementById("entrada").addEventListener("input", () => {
      const entrada = document.getElementById("entrada").value.trim();
      if (entrada === fraseAtual) {
        clearInterval(timer);
        const tempoTotal = Math.floor((Date.now() - tempoInicio) / 1000);
        const wpm = Math.round((fraseAtual.split(" ").length / tempoTotal) * 60);
        const pontos = Math.max(100 - tempoTotal * 2, 10) + wpm;
        pontuacao += pontos;

        document.getElementById("pontuacao").textContent = pontuacao;
        document.getElementById("feedback").textContent = `‚úÖ +${pontos} pontos | WPM: ${wpm}`;
        document.getElementById("entrada").disabled = true;

        if (jogadorId === "Jogador-" + salaId.split("-")[1]) {
          setTimeout(() => proximaRodada(), 3000);
        }
      }
    });

    function encerrarJogo() {
      document.getElementById("fraseDisplay").innerHTML = "<strong>üèÅ Fim do Jogo</strong>";
      document.getElementById("entrada").classList.add("hidden");
      document.getElementById("feedback").innerHTML += `<br><br><strong>Pontua√ß√£o final: ${pontuacao}</strong>`;
    }
  </script>
</body>
</html>
